{% extends 'base.html' %}
{% block body %}
  {# blueimp Gallery CSS. #}
  <link rel="stylesheet"
      href="../static/css/blueimp-gallery.min.css" type="text/css">
  <div class="container">
    <div class="row">
      <h3>
        {{ post.title }}
        <span>
          published by {{ post.user.user_name }} on 
          {{ post.posted_at.strftime("%a, %b %d, %Y at %I:%M%p") }}
        </span>
      </h3>
    </div> {# end row #}
    <div class="row">
      {% if post.gallery %}
        {# Gallery widget. #}
        <div id="blueimp-gallery"
            class="blueimp-gallery blueimp-gallery-controls">
          <div class="slides"></div>
          <h3 class="title"></h3>
          <a class="prev">‹</a>
          <a class="next">›</a>
          <a class="close">×</a>
          <a class="play-pause"></a>
          <ol class="indicator"></ol>
        </div>
        {# Gallery picture thumbnails and links. #}
        <div id="links" class="links">
          {% for pic in post.gallery %}
            <div class="col-xs-6 col-sm-3 col-md-3 col-lg-3">
              <a href="../static/uploads/{{ '{}/{}/{}'.format(
                  post.user_id, post.id, pic.filename) }}"
                  title="{{ pic.title }}" class="thumbnail">
                <img src="../static/uploads/{{ '{}/{}/thumbnails/{}'.format(
                    post.user_id, post.id, pic.filename) }}"
                    alt="{{ pic.title }}"
                    class="img-responsive img-rounded">
              </a>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div> {# end row #}
    <div class="row">
      <h4>
        {{ post.subtitle }}
      </h4>
      <p>
        {{ post.body }}
      </p>
    </div> {# end row #}
    {% if current_user.is_authenticated() %}
    <div id='root-comment' class='row'>
      {{ form.body.label }}
      <form id="comment-form" action="/view/{{ post.id }}" method=post
          accept-charset="utf-8">
        {{ form.hidden_tag() }}
        <div class="form-group">
          {{ form.body(class_='form-control') }}
          {{ form.submit(class_='btn btn-default') }}
          <a id="cancel" class="hide" href="" onclick="return false;">
            Cancel
          </a>
          {{ form.parent_id(class_='hide', readonly=true) }}
        </div>
      </form>
    </div>
    {% endif %}
    <div class="row">
      {% for comment in post.comments recursive %}
        <div class="panel panel-default" data-id={{ comment.id }}>
          <div class="panel-heading">
            {{ comment.user.user_name }}
            {% if current_user.is_authenticated() %}
              <a class="reply" href="" onclick="return false;">
                Reply
              </a>
            {% endif %}
          </div>
          <div class="panel-body">
            {{ comment.body }}
          </div>
          {% if comment.children %}
            {{ loop(comment.children) }}
          {% endif %}
        </div> {# end col #}
      {% endfor %}
    </div>  {# end row #}
  </div> {# end container #}
  {# Footer import. #}
  {% include 'footer.html' %} {# JavaScript imports. #}
  {# Gallery import. #}
  <script type="text/javascript" charset="utf-8"
      src="../static/js/blueimp-gallery.js"></script>
  {# Custom JavaScript import. #}
  <script type="text/javascript" charset="utf-8"
      src="../static/js/view-post.js"></script>
{% endblock %}
